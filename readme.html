<p>This is the fork of the FreeBSD source directory aimed to be a firewall.<br />
The <code>buildkernel</code> and <code>installkernel</code> targets build and install the kernel and the modules (see below). Please see the top of the Makefile in this directory for more information on the standard build targets and compile-time flags. The kernel configuration files reside in the sys/<arch>/conf sub-directory. FIREWALL is the default configuration used in this fork builds.</p>
<p>Modification:</p>
<p>sys/netpfil/pf - sources of pf firewall, part of kernel.</p>
<p>sbin/pfctl - sources of pfctl utility, external utility.</p>
<p>sbin/pfctl/pfctl.c - flags of pfctl utility</p>
<p>sys/netinet/tcp_fsm.h - состояния соединений</p>
<p>Description of TCP State Machine</p>
<p>In the case of TCP, the finite state machine can be considered to describe the “life stages” of a connection. Each connection between one TCP device and another begins in a null state where there is no connection, and then proceeds through a series of states until a connection is established. It remains in that state until something occurs to cause the connection to be closed again, at which point it proceeds through another sequence of transitional states and returns to the closed state.</p>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c"><span class="pp">#define TCP_NSTATES 11</span>

<span class="pp">#define TCPS_CLOSED     0   </span><span class="co">/* closed */</span>
<span class="pp">#define TCPS_LISTEN     1   </span><span class="co">/* listening for connection */</span>
<span class="pp">#define TCPS_SYN_SENT       2   </span><span class="co">/* active, have sent syn */</span>
<span class="pp">#define TCPS_SYN_RECEIVED   3   </span><span class="co">/* have sent and received syn */</span>
<span class="co">/* states &lt; TCPS_ESTABLISHED are those where connections not established */</span>
<span class="pp">#define TCPS_ESTABLISHED    4   </span><span class="co">/* established */</span>
<span class="pp">#define TCPS_CLOSE_WAIT     5   </span><span class="co">/* rcvd fin, waiting for close */</span>
<span class="co">/* states &gt; TCPS_CLOSE_WAIT are those where user has closed */</span>
<span class="pp">#define TCPS_FIN_WAIT_1     6   </span><span class="co">/* have closed, sent fin */</span>
<span class="pp">#define TCPS_CLOSING        7   </span><span class="co">/* closed xchd FIN; await FIN ACK */</span>
<span class="pp">#define TCPS_LAST_ACK       8   </span><span class="co">/* had fin and close; await FIN ACK */</span>
<span class="co">/* states &gt; TCPS_CLOSE_WAIT &amp;&amp; &lt; TCPS_FIN_WAIT_2 await ACK of FIN */</span>
<span class="pp">#define TCPS_FIN_WAIT_2     9   </span><span class="co">/* have closed, fin is acked */</span>
<span class="pp">#define TCPS_TIME_WAIT      10  </span><span class="co">/* in 2*msl quiet wait after close */</span></code></pre></div>
